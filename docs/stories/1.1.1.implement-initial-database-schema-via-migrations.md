---
Status: Done
Epic: 1
Story: 1.1.1
Title: Implement Initial Database Schema via Migrations
---

### Story
As a Developer,
I want to implement the initial database schema for the existing Laravel backend,
so that the database is ready for feature development.

### Acceptance Criteria
1.  The default `create_users_table` migration is modified to add application-specific columns, and six new migration files are created in `backend/database/migrations/`. All new tables (`medications`, `prescriptions`, etc.) must accurately reflect the schema in [`docs/architecture/database-schema.md`](../../docs/architecture/database-schema.md). The `users` table migration must be augmented to include the new fields from the schema document while retaining all default Laravel columns.
2.  The `php artisan migrate` command executes successfully against the pre-configured SQLite database, as mandated by project constraint [NFR2](../../docs/prd/requirements.md#non-functional) and documented in [`technical-assumptions.md`](../../docs/prd/technical-assumptions.md). The command must complete without errors, creating all required tables and indexes.

### Tasks / Subtasks
1.  **Modify `users` Table Migration** (AC: #1)
    *   [x] Edit the default `create_users_table` migration file (e.g., `backend/database/migrations/2014_10_12_000000_create_users_table.php`).
    *   [x] Add the `phone_number`, `address`, `role`, and `status` columns to the `users` table schema, as defined in [`docs/architecture/database-schema.md`](../../docs/architecture/database-schema.md).
    *   [x] Retain the default Laravel columns (e.g., `email_verified_at`, `remember_token`) in the migration to ensure compatibility with the framework's authentication features.
2.  **Create New Migration Files** (AC: #1)
    *   [x] Create a new migration for the `medications` table.
    *   [x] Create a new migration for the `prescriptions` table.
    *   [x] Create a new migration for the `orders` table.
    *   [x] Create a new migration for the `order_items` table.
    *   [x] Create a new migration for the `advice_requests` table.
    *   [x] Create a new migration for the `notifications` table.
3.  **Execute and Verify Migrations** (AC: #2)
    *   [x] Run `php artisan migrate` to apply the schema to the SQLite database.
    *   [x] Confirm that the command completes without errors and the expected tables and indexes are created.

### Dev Notes
**CRITICAL:** This story establishes the database foundation. All table and column names must strictly adhere to the architecture documents.

*   **Important Deviation for `users` Table:** While [`docs/architecture/database-schema.md`](../../docs/architecture/database-schema.md) is the source of truth for all **new** tables, this story requires a modification to that rule for the `users` table. To ensure future compatibility with Laravel's authentication scaffolding and features (like email verification and "remember me" functionality), the default columns (`email_verified_at`, `remember_token`) **must be preserved**. The task is to *add* the application-specific columns to the default migration, not to replace its contents entirely.
*   **Source of Truth:** For all tables *except* `users`, the complete implementation is defined in [`docs/architecture/database-schema.md`](../../docs/architecture/database-schema.md). This document provides the exact PHP code using Laravel's Schema Builder. For the `users` table, the implementation will be a combination of the Laravel default migration plus the additional columns specified in the schema document.
*   **Handling Existing Migrations:** The default `users` table migration (e.g., `2014_10_12_000000_create_users_table.php`) must be **modified** as described above. Other default migrations provided by Laravel (e.g., for `jobs`, `failed_jobs`, `personal_access_tokens`) can be ignored for this story, as they are framework-level concerns.

#### Testing
*   As per [`technical-assumptions.md`](../../docs/prd/technical-assumptions.md), the project follows a unit and integration testing strategy.
*   For this story, testing is primarily a verification process. The primary test is the successful execution of `php artisan migrate` as specified in AC #2.
*   Manual verification of the generated `database.sqlite` file schema is recommended to confirm all constraints and indexes are created correctly. No specific unit or feature test files are required for this story.

### Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |

### Dev Agent Record
This section is populated by the development agent during implementation.

#### Agent Model Used
_T-B-D_

#### Debug Log References
*   Initial migration failed due to existing tables. Resolved by running `migrate:fresh`.
*   Duplicate migration file for `advice_requests` was created and caused an error. Resolved by deleting the duplicate file.

#### Completion Notes List
*   All database migrations have been created and successfully executed.
*   The `users` table has been modified to include the new fields while retaining the default Laravel columns.
*   The database schema now matches the definition in `docs/architecture/database-schema.md`.

#### File List
*   `backend/database/migrations/0001_01_01_000000_create_users_table.php`
*   `backend/database/migrations/2025_08_30_190456_create_medications_table.php`
*   `backend/database/migrations/2025_08_30_190503_create_prescriptions_table.php`
*   `backend/database/migrations/2025_08_30_190602_create_orders_table.php`
*   `backend/database/migrations/2025_08_30_190613_create_order_items_table.php`
*   `backend/database/migrations/2025_08_30_190621_create_advice_requests_table.php`
*   `backend/database/migrations/2025_08_30_190648_create_notifications_table.php`

### QA Results
**Gate Decision: PASS**

**Summary:**
The implementation perfectly aligns with the requirements outlined in the story and the detailed specifications in `docs/architecture/database-schema.md`. All acceptance criteria have been verified and met.

*   **AC #1 Verification:** The `users` table migration correctly adds the required application-specific columns while preserving the default Laravel columns, as per the dev notes. All six new migration files (`medications`, `prescriptions`, `orders`, `order_items`, `advice_requests`, `notifications`) are 1:1 matches with the architecture document.
*   **AC #2 Verification:** The developer's log confirms that the `php artisan migrate` command was executed successfully against the required SQLite database (NFR2). The migration code is clean, correct, and includes appropriate indexes and foreign key constraints.

**Risks:** None. The foundational schema has been implemented correctly, mitigating the primary risk associated with this story.

**Action:** Proceed with development. No further action is required for this story.