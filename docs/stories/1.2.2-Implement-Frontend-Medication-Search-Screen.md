---
Status: Approved
Epic: 1
Story: 1.2.2
Title: Implement Frontend Medication Search Screen
---

## Story

**As a** User,
**I want** a search screen where I can type a medication name and see a list of matching results,
**so that** I can find available medications.

## Acceptance Criteria

1.  The Flutter application has a search screen containing a `Form Input Field` variant for search, as defined in the [`component-library-design-system.md`](../../docs/front-end-spec/component-library-design-system.md). The layout adheres to the `8-point grid system` from the [`branding-style-guide.md`](../../docs/front-end-spec/branding-style-guide.md).
2.  As the user types, the app displays skeleton loaders that mimic the list content, as specified in [`performance-considerations.md`](../../docs/front-end-spec/performance-considerations.md). Once data is fetched, it displays a list of matching medications, showing name, price, and availability.
3.  If no medications match the search term, a clear "No results found" message is displayed.
4.  If a network error occurs, a "Connection problem. Please try again." message is displayed, consistent with the error handling patterns defined in [`docs/architecture/error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md).

## Tasks / Subtasks

- [ ] **Frontend: Create Search Screen UI (AC: #1, #3)**
  - [ ] Create a new feature module directory: `frontend/lib/features/medication_search/` as per the structure in [`unified-project-structure.md`](../../docs/architecture/unified-project-structure.md).
  - [ ] Create a new screen file: `frontend/lib/features/medication_search/screens/medication_search_screen.dart`.
  - [ ] The screen must contain a `TextField` for user input, which must have a visible label and a clear focus indicator to meet the requirements in [`accessibility-requirements.md`](../../docs/front-end-spec/accessibility-requirements.md).
  - [ ] The screen will use a `ListView.builder` to efficiently display results, as per [`performance-considerations.md`](../../docs/front-end-spec/performance-considerations.md).
  - [ ] Implement a "No results found" message that displays when the search results are empty.
- [ ] **Frontend: Implement State Management (AC: #2, #4)**
  - [ ] Create a `MedicationSearchProvider` in `frontend/lib/features/medication_search/providers/medication_search_provider.dart`, following the `ChangeNotifier` pattern from [`frontend-architecture.md`](../../docs/architecture/frontend-architecture.md).
  - [ ] The provider should expose properties for the loading state, search results (`List<Medication>`), and any errors (`ApiException`).
  - [ ] Create a method in the provider to call the API. This method must be debounced to avoid excessive API calls as the user types.
  - [ ] Implement error handling to catch `ApiException` and update the state to display the "Connection problem. Please try again." message, as detailed in [`error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md).
- [ ] **Frontend: Implement API Service (AC: #2)**
  - [ ] Create `frontend/lib/features/medication_search/api/medication_api_service.dart` following the `ApiService` template in [`frontend-architecture.md`](../../docs/architecture/frontend-architecture.md).
  - [ ] Implement a method `searchMedications(String query)` that calls the `GET /medications` endpoint with the `name` query parameter, using the central `ApiClientService`.
  - [ ] The service must handle `DioException` and re-throw a structured `ApiException` for the provider to consume.
- [ ] **Frontend: Create Widget Tests (AC: #1, #3, #4)**
  - [ ] Create widget tests in `frontend/test/features/medication_search/` for the `MedicationSearchScreen`, as specified in the [`testing-strategy.md`](../../docs/architecture/testing-strategy.md).
  - [ ] Test that the screen renders correctly with its initial state.
  - [ ] Test that the "No results found" message is displayed when the provider has empty data.
  - [ ] Test that the error message is displayed when the provider has an error.

## Dev Notes

### Prerequisite Story
This story is dependent on the completion of story `1.2.1: Create Public Medication Search API Endpoint`. The API must be available before frontend development can be fully tested.

### Data Models
- **`Medication`**: The frontend will use the `Medication` Dart model defined in [`docs/architecture/data-models.md`](../../docs/architecture/data-models.md).

### API Specifications
- **Endpoint**: `GET /medications`
- **Query Parameter**: `name` (string).
- **Success Response**: `200 OK` with a JSON array of medication objects.
- **Error Response**: The central `ApiClientService` will parse errors into a structured `ApiException`.
- **Source of Truth**: The API contract is definitively specified in [`docs/Medications-API.txt`](../../docs/OpenAPI/Medications-API.txt).

### File Locations
- **Frontend Feature Module**: `frontend/lib/features/medication_search/`
- **Source**: [`docs/architecture/unified-project-structure.md`](../../docs/architecture/unified-project-structure.md)

### Technical Constraints
- All frontend API calls must be made through a feature-specific `ApiService` which uses the central `ApiClientService`. [Source: [`docs/architecture/frontend-architecture.md`](../../docs/architecture/frontend-architecture.md)]
- Frontend state management must use the `Provider` package, following the MVVM pattern established in the architecture. [Source: [`docs/architecture/frontend-architecture.md`](../../docs/architecture/frontend-architecture.md)]
- All code must adhere to the project's established coding conventions. [Source: [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md)]
- The implementation must use the technologies defined in the project's tech stack. [Source: [`docs/architecture/tech-stack.md`](../../docs/architecture/tech-stack.md)]

### Design & UX
- **Styling**: All UI elements must use the colors, typography, and spacing defined in the [`branding-style-guide.md`](../../docs/front-end-spec/branding-style-guide.md).
- **Loading State**: Use skeleton loaders for list fetching as per [`performance-considerations.md`](../../docs/front-end-spec/performance-considerations.md).
- **Accessibility**: The search input must have a visible label and focus indicator, and list items must have adequate touch targets (48x48dp). [Source: [`docs/front-end-spec/accessibility-requirements.md`](../../docs/front-end-spec/accessibility-requirements.md)]

### Testing
- **Frontend**: Create Widget tests for the search screen to verify UI states (loading, error, no results, has results). The tests should live in `frontend/test/features/medication_search/`.
- **Source**: [`docs/architecture/testing-strategy.md`](../../docs/architecture/testing-strategy.md)

## Change Log

| Date | Version | Description | Author |
| :---: | :---: | :--- | :--- |
| 2025-09-01 | 1.0 | Initial draft created from parent story 1.2 | Scrum Master |
| 2025-09-01 | 1.1 | Validation completed, story approved for implementation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
