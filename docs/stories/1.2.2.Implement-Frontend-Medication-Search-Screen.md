---
Status: Ready for Dev
Epic: 1
Story: 1.2.2
Title: Implement Frontend Medication Search Screen
---

## Story

**As a** User,
**I want** a search screen where I can type a medication name and see a list of matching results,
**so that** I can find available medications.

## Acceptance Criteria

1.  The Flutter application has a search screen with a text input field for searching medications.
2.  As the user types, the app calls the `GET /api/medications?search={query}` endpoint and displays a list of matching medications. Each item in the list must show the medication's name, price, and availability (e.g., "In Stock" or "Out of Stock") based on the `Medication` model's `isInStock` property defined in [`docs/architecture/data-models.md`](../../docs/architecture/data-models.md).
3.  If no medications match the search term, a "No results found" message is displayed.
4.  If a network error occurs during the API call, a user-friendly message, as defined by the `ApiError` class in [`docs/architecture/error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md), is displayed (e.g., "Connection problem. Please check your internet.").

## Tasks / Subtasks

- [ ] **Frontend: Create Search Screen UI (AC: #1, #3)**
  - [ ] Create a new feature module directory: `lib/features/medication_search/`, following the structure in [`docs/architecture/frontend-architecture.md`](../../docs/architecture/frontend-architecture.md).
  - [ ] Create a new screen file: `lib/features/medication_search/screens/medication_search_screen.dart`. The file name must be `snake_case.dart` as per [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md).
  - [ ] The screen widget, `MedicationSearchScreen`, must contain a `TextField` for user input and a `ListView` to display results.
  - [ ] Create a reusable widget `lib/features/medication_search/widgets/medication_list_item.dart` to display a single medication's details.
  - [ ] Implement UI states to show a loading indicator, the results list, a "No results found" message, or an error message based on the provider's state.
  - [ ] All new public classes and methods must have DartDoc comments as mandated by [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md).

- [ ] **Frontend: Implement State Management (AC: #2, #4)**
  - [ ] Create a `MedicationSearchProvider` in `lib/features/medication_search/providers/medication_search_provider.dart`. The class name must end in `Provider` as per [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md).
  - [ ] The provider must use the `provider` package specified in [`docs/architecture/tech-stack.md`](../../docs/architecture/tech-stack.md).
  - [ ] The provider should expose `bool isLoading`, `List<Medication> medications`, and `ApiError? error` properties to the UI.
  - [ ] Implement a `search(String query)` method in the provider. This method should be debounced (e.g., 300ms) to avoid excessive API calls.
  - [ ] Implement error handling by catching `ApiException` from the service layer and setting the `error` state property, as detailed in [`docs/architecture/error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md).

- [ ] **Frontend: Implement API Service (AC: #2)**
  - [ ] Create `lib/features/medication_search/services/medication_api_service.dart`.
  - [ ] Implement a class `MedicationApiService` with a method `Future<List<Medication>> searchMedications(String query)`.
  - [ ] This service must use the central `ApiClient` (from `lib/core/services/api_client.dart`) to make the `GET` request, adhering to the **API Interaction Pattern** in [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md).
  - [ ] The service must parse the JSON response into a `List<Medication>`, using the Dart model from `lib/shared/models/medication.dart`.

- [ ] **Frontend: Create Widget and Unit Tests (AC: #1, #3, #4)**
  - [ ] Following the test organization in [`docs/architecture/testing-strategy.md`](../../docs/architecture/testing-strategy.md), create widget tests for the `MedicationSearchScreen` in `test/widget/screens/medication_search_screen_test.dart`.
  - [ ] Use `mockito` (from [`docs/architecture/tech-stack.md`](../../docs/architecture/tech-stack.md)) to mock the `MedicationSearchProvider` and test all UI states: loading, empty results, error, and a list of results.
  - [ ] Create unit tests for `MedicationSearchProvider` in `test/integration/providers/` to verify its logic when interacting with a mocked `MedicationApiService`.
  - [ ] Create unit tests for `MedicationApiService` in `test/unit/services/` to verify it correctly calls the `ApiClient` and parses data.

## Architectural Compliance

- **Coding Standards**: All code must adhere to the naming conventions, mandatory documentation, and architectural patterns (API Service layer, Provider state management) defined in [`docs/architecture/coding-standards.md`](../../docs/architecture/coding-standards.md).
- **Tech Stack**: Development must exclusively use the libraries specified in [`docs/architecture/tech-stack.md`](../../docs/architecture/tech-stack.md), specifically `provider` for state management and `http` for API calls (via the `ApiClient`).
- **Error Handling**: All error handling must conform to the patterns and data structures (e.g., `ApiError`, `ApiException`) established in [`docs/architecture/error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md).
- **Testing**: All tests must be organized and written according to the guidelines in [`docs/architecture/testing-strategy.md`](../../docs/architecture/testing-strategy.md).

## Dev Notes

### Prerequisite Story
This story is dependent on the completion of story `1.2.1: Create Public Medication Search API Endpoint`. The API must be available before frontend development can be fully tested against a live backend.

### API Specifications
- **Endpoint**: `GET /api/medications`
- **Query Parameter**: `search` (string).
- **Success Response**: `200 OK` with a JSON object containing a `data` key, which holds an array of medication objects.
- **Error Response**: The central `ApiClient` will parse errors into a structured `ApiException` as defined in [`docs/architecture/error-handling-strategy.md`](../../docs/architecture/error-handling-strategy.md).

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-01 | 1.0 | Initial draft created from parent story 1.2 | Scrum Master |

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results