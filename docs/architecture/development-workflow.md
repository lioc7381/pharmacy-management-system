## Development Workflow

### Local Development Setup

This section provides a step-by-step guide for setting up the local development environment. These instructions are designed to be followed sequentially to ensure a developer can go from a fresh repository clone to a fully running application with minimal friction.

#### Prerequisites

Before cloning the repository, ensure the following tools are installed and configured on your system. The specified versions are mandatory to maintain a consistent development environment.

*   **PHP:** `8.3.x`
*   **Composer:** `2.7.x`
*   **Flutter SDK:** `3.22.x`
*   **SQLite3:** Command-line interface for SQLite.

#### Initial Setup

These one-time commands must be run after cloning the repository to install dependencies and configure the applications.

```bash
# 1. Clone the repository
git clone <repository-url>
cd pharmacy-management-system

# 2. Install backend dependencies
cd backend
composer install

# 3. Configure backend environment
cp .env.example .env
php artisan key:generate
touch database/database.sqlite # Create the SQLite database file
php artisan migrate --seed # Run migrations and seed initial data

# 4. Install frontend dependencies
cd ../frontend
flutter pub get

# 5. Configure frontend environment (if needed)
# cp .env.example .env
```

#### Development Commands

The frontend and backend applications must be run in separate terminal sessions.

**Terminal 1: Start the Backend API Server**

```bash
# Navigate to the backend directory
cd backend

# Start the Laravel development server (defaults to http://localhost:8000)
php artisan serve
```

**Terminal 2: Start the Frontend Application**

```bash
# Navigate to the frontend directory
cd frontend

# Run the Flutter application on a connected Android device or emulator
flutter run
```

### Environment Configuration

This section defines the environment variables required to run the application. Using environment variables is a critical best practice that separates configuration from code, allowing for flexibility and preventing sensitive data from being committed to version control. Each application (`backend` and `frontend`) manages its own `.env` file.

#### Backend (`backend/.env`)

The Laravel backend is configured via a `.env` file in its root directory. This file is created by copying `.env.example` during the initial setup.

```bash
# Application Configuration
APP_NAME="Pharmacy Management System"
APP_ENV=local
APP_KEY= # This will be generated by `php artisan key:generate`
APP_DEBUG=true
APP_URL=http://localhost:8000

# Logging Configuration
LOG_CHANNEL=stack
LOG_LEVEL=debug

# Database Configuration (CRITICAL)
# This MUST be set to sqlite to adhere to project constraints.
# The database path is now handled automatically in config/database.php for portability.
DB_CONNECTION=sqlite

# Cache, Session, and Queue Drivers
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync

# Sanctum Configuration
SANCTUM_STATEFUL_DOMAINS=localhost:8000
```

#### Database Configuration for Portability

To ensure the database path is portable across all developer machines and operating systems, the default path is configured using Laravel's `database_path()` helper function. This change is made directly in the configuration file, removing the need to specify an absolute path in the `.env` file.

File: `backend/config/database.php`
```php
// ...
'sqlite' => [
    'driver' => 'sqlite',
    // Use the database_path() helper to construct a portable, relative path.
    // This will default to 'backend/database/database.sqlite' correctly
    // on any machine, regardless of the project's absolute path.
    'database' => env('DB_DATABASE', database_path('database.sqlite')),
    'prefix' => '',
    'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
],
// ...
```

#### Frontend (`frontend/.env`)

The Flutter frontend will use the `flutter_dotenv` package to manage its environment variables. A `.env` file should be created in the `frontend/` root.

**CRITICAL NOTE for Android Emulators:** The Android emulator runs in a virtualized network. To connect to a server running on your host machine's `localhost`, you must use the special IP address `10.0.2.2`.

```bash
# The base URL for the Laravel API backend.
# Use 10.0.2.2 instead of localhost to connect from the Android emulator.
API_BASE_URL=http://10.0.2.2:8000/api
```

---